<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="REIMBURSEMENT" >
  <resultMap id="BaseResultMap" type="com.icss.oa.process.pojo.Reimbursement" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 23 08:38:25 CST 2015.
    -->
    <id column="REIM_ID" property="reimId" jdbcType="DECIMAL" />
    <result column="REIM_TIME" property="reimTime" jdbcType="TIMESTAMP" />
    <result column="REIM_SUM" property="reimSum" jdbcType="DECIMAL" />
    <result column="EMP_ID" property="empId" jdbcType="DECIMAL" />
    <result column="REIM_REASON" property="reimReason" jdbcType="VARCHAR" />
    <result column="LEADER_ID" property="leaderId" jdbcType="DECIMAL" />
    <result column="EMP_NAME" property="empName" jdbcType="VARCHAR" />
    <result column="LEADER_NAME" property="leaderName" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="DECIMAL" />
    <result column="ENDSTATUS" property="endstatus" jdbcType="DECIMAL" />
  </resultMap>
  
  <insert id="insert" parameterType="com.icss.oa.process.pojo.Reimbursement" >
    insert into REIMBURSEMENT (REIM_ID, REIM_TIME, REIM_SUM, 
      EMP_ID, REIM_REASON, LEADER_ID, 
      EMP_NAME, LEADER_NAME, STATUS, 
      ENDSTATUS)
    values (reim_seq.nextval, sysdate, #{reimSum,jdbcType=DECIMAL}, 
      #{empId,jdbcType=DECIMAL}, #{reimReason,jdbcType=VARCHAR}, #{leaderId,jdbcType=DECIMAL}, 
      #{empName,jdbcType=VARCHAR}, #{leaderName,jdbcType=VARCHAR}, #{status,jdbcType=DECIMAL}, 
      #{endstatus,jdbcType=DECIMAL})
  </insert>
  
  <update id="updateStatus" parameterType="com.icss.oa.process.pojo.Reimbursement">
      UPDATE reimbursement 
      <set>
          <if test="status!=null">
              status=#{status},
          </if>
          <if test="endstatus!=null">
              endstatus=#{endstatus}
          </if>
      </set>  
      WHERE reim_id=${reimId}
  </update>
  
  <!-- 得到刚插入表的自动编号 -->
  <select id="getLastId" resultType="java.lang.Integer">
      SELECT reim_seq.currval from dual
  </select>
  
  <!-- 返回 请假列表-->
  <select id="query" resultMap="BaseResultMap" parameterType="java.util.Map">
     select * from  (select r.*, rownum rnum from (select * from reimbursement order by reim_time desc) r  
      where r.emp_id = #{empId} 
      ) where rnum between #{start} and #{end}
  </select>
  
   <!-- 返回 请假单条请假记录-->
  <select id="queryById" parameterType="java.lang.Integer" resultMap="BaseResultMap">
      select * from reimbursement where reim_id=#{reimId}    
  </select>
  
  <select id="count" parameterType="java.lang.Integer" resultType="java.lang.Integer">
      select count(*) from reimbursement where emp_id = #{empId} 
  </select>
  
</mapper>