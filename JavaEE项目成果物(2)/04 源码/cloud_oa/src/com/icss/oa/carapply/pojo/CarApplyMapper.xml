<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="CAR_APPLY" >
  <resultMap id="BaseResultMap" type="com.icss.oa.carapply.pojo.CarApply" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jul 24 11:11:31 CST 2015.
    -->
    <id column="CARAPPLY_ID" property="carapplyId" jdbcType="DECIMAL" />
    <result column="EMP_ID" property="empId" jdbcType="DECIMAL" />
    <result column="APPLY_TIME" property="applyTime" jdbcType="TIMESTAMP" />
    <result column="REASON" property="reason" jdbcType="VARCHAR" />
    <result column="START_TIME" property="startTime" jdbcType="TIMESTAMP" />
    <result column="END_TIME" property="endTime" jdbcType="TIMESTAMP" />
    <result column="LEADER_ID" property="leaderId" jdbcType="DECIMAL" />
    <result column="EMP_NAME" property="empName" jdbcType="VARCHAR" />
    <result column="LEADER_NAME" property="leaderName" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="DECIMAL" />
    <result column="ENDSTATUS" property="endstatus" jdbcType="DECIMAL" />
    <result column="ROUTE" property="route" jdbcType="VARCHAR" />
  </resultMap>
  
  <insert id="insert" parameterType="com.icss.oa.carapply.pojo.CarApply" >
    insert into CAR_APPLY (CARAPPLY_ID, EMP_ID, APPLY_TIME, 
      REASON, START_TIME, END_TIME, 
      LEADER_ID, EMP_NAME, LEADER_NAME, 
      STATUS, ENDSTATUS, ROUTE
      )
    values (carapply_seq.nextval, #{empId,jdbcType=DECIMAL}, sysdate, 
      #{reason,jdbcType=VARCHAR}, #{startTime,jdbcType=TIMESTAMP}, #{endTime,jdbcType=TIMESTAMP}, 
      #{leaderId,jdbcType=DECIMAL}, #{empName,jdbcType=VARCHAR}, #{leaderName,jdbcType=VARCHAR}, 
      #{status,jdbcType=DECIMAL}, #{endstatus,jdbcType=DECIMAL}, #{route,jdbcType=VARCHAR}
      )
  </insert>

   <update id="updateStatus" parameterType="com.icss.oa.carapply.pojo.CarApply">
      UPDATE Car_Apply 
      <set>
          <if test="status!=null">
              status=#{status},
          </if>
          <if test="endstatus!=null">
              endstatus=#{endstatus}
          </if>
      </set>  
      WHERE carapply_id=${carapplyId}
  </update>
  
  <!-- 得到刚插入表的自动编号 -->
  <select id="getLastId" resultType="java.lang.Integer">
      SELECT carapply_seq.currval from dual
  </select>
  
    <!-- 返回 用车列表-->
  <select id="query" resultMap="BaseResultMap" parameterType="java.util.Map">
     select * from  (select r.*, rownum rnum from (select * from Car_Apply order by apply_time desc) r  
      where r.emp_id = #{empId} 
      ) where rnum between #{start} and #{end}
  </select>
  
     <!-- 返回 单条用车记录-->
  <select id="queryById" parameterType="java.lang.Integer" resultMap="BaseResultMap">
      select * from Car_Apply where carapply_id=#{carApplyId}    
  </select>
  
  <select id="count" parameterType="java.lang.Integer" resultType="java.lang.Integer">
      select count(*) from Car_Apply where emp_id = #{empId} 
  </select>
  
   
</mapper>